IF EXISTS (SELECT name FROM sysobjects 
   WHERE name = 'PRC_CURSOR_EXAMPLE' AND type = 'P')
   DROP PROCEDURE PRC_CURSOR_EXAMPLE
GO
CREATE PROCEDURE PRC_CURSOR_EXAMPLE 
AS
DECLARE @W_P_CODE	VARCHAR(10)
DECLARE @W_P_DESCRIPT	VARCHAR(35)
DECLARE @W_TOT		INTEGER
DECLARE PROD_CURSOR CURSOR 
   FOR SELECT P_CODE, P_DESCRIPT FROM PRODUCT WHERE P_ONHAND > (SELECT AVG(P_ONHAND) FROM PRODUCT)
BEGIN
PRINT('PRODUCTS WITH P_ONHAND > AVG(P_ONHAND)')
PRINT('======================================')
OPEN PROD_CURSOR
FETCH NEXT FROM PROD_CURSOR INTO @W_P_CODE, @W_P_DESCRIPT
WHILE @@FETCH_STATUS=0
BEGIN
PRINT(@W_P_CODE + ' -> ' + @W_P_DESCRIPT )
FETCH NEXT FROM PROD_CURSOR INTO @W_P_CODE, @W_P_DESCRIPT   
END
PRINT('======================================')
PRINT('TOTAL PRODUCT PROCESSED ' + cast(@@CURSOR_ROWS as varchar(10)))
PRINT('--- END OF REPORT ----')
CLOSE PROD_CURSOR
END
